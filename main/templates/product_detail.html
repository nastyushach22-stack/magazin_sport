{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>{{ product.name }}</title>
<link rel="icon" href="img/logo3.png" type="image/x-icon" />
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<style>
body {
  font-family: 'Helvetica Neue', Arial, sans-serif;
  background-color: #f9f9f9;
  margin: 0;
  padding: 30px;
  color: #222;
}
.container {
  display: flex;
  flex-wrap: wrap;
  max-width: 1200px;
  margin: auto;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.07);
  overflow: hidden;
}
.image-section {
  flex: 1 1 45%;
  padding: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.main-image {
  width: 100%;
  max-width: 400px;
  border-radius: 10px;
  cursor: zoom-in;
  transition: box-shadow 0.2s;
}
.main-image:hover {
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}
.thumbnails-container {
  display: flex;
  gap: 15px;
  margin-top: 20px;
  flex-wrap: wrap;
  justify-content: center;
}
.thumbnail {
  width: 70px;
  height: 70px;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.thumbnail:hover {
  border-color: #ff6f61;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.info-section {
  flex: 1 1 55%;
  padding: 30px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.product-title {
  font-size: 36px;
  font-weight: 700;
  margin-bottom: 10px;
  line-height: 1.2;
}
.price {
  font-size: 28px;
  color: #e22262d3;
  margin-bottom: 20px;
  font-weight: bold;
}
.description {
  font-size: 16px;
  line-height: 1.5;
  margin-bottom: 30px;
}
section {
  margin-bottom: 20px;
}
h3 {
  font-size: 18px;
  color: #555;
  margin-bottom: 10px;
}
/* Обновленный стиль для блока характеристик */
.content-box {
  background: linear-gradient(135deg, #f9f9f9, #ffffff);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.07);
  font-size: 15px;
  color: #222;
  list-style-type: none;
  white-space: pre-line;
}
.content-box:hover {
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  transform: translateY(-2px);
}
.content-box p {
  margin: 8px 0;
  color: #222;
}
.buttons {
  gap: 20px;
  margin-top: 30px;
}
.btn {
  flex: 1;
  padding: 15px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: background-color 0.2s, transform 0.2s;
}
.btn-primary {
  background-color: #e22262d3;
  color: #fff;
}
.btn-primary:hover {
  background-color: #e22262d3;
  transform: scale(1.02);
}
.btn-secondary {
  background-color: #e0e0e0;
  color: #222;
}
.btn-secondary:hover {
  background-color: #d6d6d6;
  transform: scale(1.02);
}

/* Модальное окно для увеличенного изображения */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}
.modal img {
  max-width: 80%;
  max-height: 80%;
  border-radius: 12px;
  cursor: zoom-out;
}
.characteristics-details {
  margin-top: 20px; /* одна пустая строка */
}
.sizes-row {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}
.size-option {
  padding: 8px 14px;
  border: 2px solid #c7c7c7;
  border-radius: 8px;
  cursor: pointer;
  font-size: 15px;
  transition: 0.25s;
  user-select: none;
}
.size-option:hover {
  border-color: #e22262d3;
}
.size-option.active {
  background: #e22262d3;
  color: white;
  border-color: #e22262d3;
}
</style>
</head>
<body>

<header>{% include 'baze.html' %}</header>

<!-- Кнопка назад -->
<div style="margin-bottom:20px;">
  <button onclick="history.back()" style="background:none; border:none; cursor:pointer; padding:0;">
  <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M14 6L8 12L14 18" stroke="gray" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>
</div>

<div class="container">
  <!-- Левая часть: изображение -->
  <div class="image-section">
    <img src="{% static product.photos.0 %}" alt="{{ product.name }}" class="main-image" id="mainImage" onclick="openModal(this.src)">
    <div class="thumbnails-container">
      {% for photo in product.photos %}
        <div class="thumbnail" onclick="changeMainImage(this.children[0].src)">
          <img src="{% static photo %}" alt="{{ product.name }} thumbnail">
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Правая часть: описание -->
  <div class="info-section">
    <div>
      <div class="product-title">{{ product.name }}</div>
      <div class="price">{{ product.price }}</div>
      <div class="description">{{ product.description }}</div>

      <section>
        <h3>Характеристики</h3>
        <div class="content-box">{{ product.characteristics|safe }}</div>
      </section>

      <section>
        <h3>Размеры</h3>
        <div class="sizes-row">
          {% for size in product.sizes %}
          <div class="size-option" onclick="selectSize(this)">
            {{ size }}
          </div>
          {% endfor %}
        </div>
      </section>
    </div>
    <!-- Кнопки -->
    <div class="buttons" style="margin-top:20px; display:flex; gap:20px;">
      <!-- Серая кнопка -->
      <button id="add-to-cart-btn"
        style="
          flex:1;
          position:relative;
          width:100%;
          padding:15px 20px;
          font-size:16px;
          border-radius:8px;
          border:none;
          cursor:pointer;
          background:#e0e0e0;
          color:#222;
          font-weight:bold;
          overflow:hidden;
        ">
        <!-- текст -->
        <span id="btn-text"
          style="
            position:absolute;
            top:50%;
            left:50%;
            transform:translate(-50%, -50%);
            transition:opacity 0.2s ease;
          ">
          Добавить в корзину
        </span>

        <!-- счётчик -->
        <div id="quantity-controls"
          style="
            position:absolute;
            top:50%;
            left:50%;
            transform:translate(-50%, -50%);
            display:none;
            align-items:center;
            justify-content:center;
            gap:10px;
            opacity:0;
            transition:opacity 0.2s ease;
          ">
          <span id="decrease"
            style="font-size:20px; width:30px; height:30px; cursor:pointer; user-select:none;">−</span>
          <span id="counter" style="min-width:20px; text-align:center; font-weight:bold;">1</span>
          <span id="increase"
            style="font-size:20px; width:30px; height:30px; cursor:pointer; user-select:none;">+</span>
        </div>
      </button>

      <!-- Вторая кнопка -->
      <button id="buy-now-btn" class="btn btn-primary" style="flex:1;">Купить сейчас</button>
    </div>
  </div>
</div>

<!-- Модальное окно для увеличенного изображения -->
<div class="modal" id="imgModal" onclick="closeModal()">
  <img src="" alt="">
</div>

<script>
let count = 1;
let isAdded = false;
let selectedSize = null;

// Обработчик выбора размера
function selectSize(element) {
  document.querySelectorAll('.size-option').forEach(opt => opt.classList.remove('active'));
  element.classList.add('active');
  selectedSize = element.textContent.trim();
}

// Объявляем переменные
const btn = document.getElementById('add-to-cart-btn');
const btnText = document.getElementById('btn-text');
const quantityControls = document.getElementById('quantity-controls');
const counter = document.getElementById('counter');
const increaseBtn = document.getElementById('increase');
const decreaseBtn = document.getElementById('decrease');

// Обновление корзины
function updateCart() {
  if (!selectedSize) {
    alert('Пожалуйста, выберите размер!');
    return;
  }
  const name = "{{ product.name|escapejs }}";
  const img = "{% static product.photos.0 %}";
  const price = "{{ product.price }}";

  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  const index = cart.findIndex(i => i.name === name && i.size === selectedSize);

  if (count > 0) {
    if (index >= 0) {
      cart[index].count = count;
    } else {
      cart.push({ name, img, price, size: selectedSize, count });
    }
  } else {
    if (index >= 0) {
      cart.splice(index, 1);
    }
  }
  localStorage.setItem('cart', JSON.stringify(cart));
}

// Обработчик кнопки "Добавить в корзину"
btn.addEventListener('click', () => {
  if (!selectedSize) {
    alert('Пожалуйста, выберите размер!');
    return;
  }
  if (!isAdded) {
    isAdded = true;
    btnText.style.opacity = '0';
    setTimeout(() => {
      btnText.style.display = 'none';
      quantityControls.style.display = 'flex';
      setTimeout(() => {
        quantityControls.style.opacity = '1';
      }, 10);
    }, 200);
    counter.textContent = count;
    updateCart();
  }
});

// Увеличение количества
increaseBtn.addEventListener('click', () => {
  count++;
  counter.textContent = count;
  updateCart();
});

// Уменьшение количества
decreaseBtn.addEventListener('click', () => {
  if (count > 1) {
    count--;
    counter.textContent = count;
    updateCart();
  } else if (count === 1) {
    count = 0;
    updateCart();
    // Возврат кнопки
    isAdded = false;
    count = 1;
    quantityControls.style.opacity = '0';
    setTimeout(() => {
      quantityControls.style.display = 'none';
      btnText.style.display = 'block';
      setTimeout(() => {
        btnText.style.opacity = '1';
      }, 10);
    }, 200);
  }
});

// Купить сейчас
document.getElementById('buy-now-btn').addEventListener('click', () => {
  if (!selectedSize) {
    alert('Пожалуйста, выберите размер!');
    return;
  }
  const name = "{{ product.name|escapejs }}";
  const img = "{% static product.photos.0 %}";
  const price = "{{ product.price }}";

  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  const index = cart.findIndex(i => i.name === name && i.size === selectedSize);

  if (index >= 0) {
    cart[index].count = 1;
  } else {
    cart.push({ name, img, price, size: selectedSize, count: 1 });
  }

  localStorage.setItem('cart', JSON.stringify(cart));
  window.location.href = "/cart/";
});
</script>

</body>
</html>